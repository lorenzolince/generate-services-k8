apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: agenerarte-service
  namespace: argocd
spec:
  syncPolicy:
    preserveResourcesOnDeletion: false
  generators:
    - git:
        repoURL: https://github.com/lorenzolince/generate-service-backend.git
        revision: HEAD
        files:
          - path: app/generate-services/backend/api.yaml
    - git:
        repoURL: https://github.com/lorenzolince/generate-service-ui.git
        revision: HEAD
        files:
          - path: app/generate-services/frontend/api.yaml
  template:
    metadata:
      name: '{{projectName}}'
    spec:
      project: {{apiName}}
      source:
        repoURL: https://github.com/lorenzolince/genericDeploy.git
        targetRevision: '{{targetRevisionName}}'
        path: helmcharts/llince
        helm:
          valuesObject:
            fullnameOverride: '{{apiName}}'
            image:
              repository: '{{repositoryName}}'
              tag: '{{tagVersion}}'
            manualRender: '{{manualRender}}'
          ignoreMissingValueFiles: true
          valueFiles:
            - default_value.yaml
            - '{{valuesFile}}'
            - '{{valuesSecretFile}}'
      destination:
        server: https://kubernetes.default.svc
        namespace: '{{valueNamesPace}}'
      syncPolicy:
        automated:
          prune: true
          selfHeal: true